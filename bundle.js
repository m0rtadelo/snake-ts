(()=>{"use strict";var t;!function(t){t[t.menu=0]="menu",t[t.playing=1]="playing",t[t.paused=2]="paused"}(t||(t={}));var e,s=["up","down","left","right"],n=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.in=function(t){return t.x===this.x&&t.y===this.y},t}();!function(t){t.Right="right",t.Left="left",t.Up="up",t.Down="down",t.Enter="ok",t.Escape="ko"}(e||(e={}));var i=function(){function t(t,e){this.points=0,this.size=0,this.w=e.width,this.h=e.height,this.reset(t)}return Object.defineProperty(t.prototype,"head",{get:function(){return this.body[this.body.length-1]},enumerable:!1,configurable:!0}),t.prototype.reset=function(t){this.position=new n(this.w/2,this.h/2),this.movement=e.Right,this.body=new Array,this.size=t,this.points=0},t.prototype.move=function(){var t=function(t,e){return e+t};this.position.x=t(this.movement===e.Right?1:this.movement===e.Left?-1:0,this.position.x),this.position.y=t(this.movement===e.Down?1:this.movement===e.Up?-1:0,this.position.y),this.body.push(new n(this.position.x,this.position.y)),this.body.length>this.size&&(this.body=this.body.splice(1))},t.prototype.isDead=function(){for(var t=0;t<this.body.length-1;t++)if(this.head.in(this.body[t])||this.head.x<0||this.head.x>=this.w||this.head.y<0||this.head.y>=this.h)return!0;return!1},t.prototype.eat=function(t){t.spawn(this.body),this.points++,this.size=this.size+this.points},t}(),h=function(){function t(t){this.position=new n(0,0),this.w=t.width,this.h=t.height,this.spawn()}return t.prototype.spawn=function(t){var e=this;do{this.position.x=Math.floor(Math.random()*this.w),this.position.y=Math.floor(Math.random()*this.h)}while(t&&t.some((function(t){return t.in(e.position)})))},t}(),o=function(){function n(e,s,n){this._status=t.menu,this.best=-1,this.speed=e.speed,this.render=s,this.snake=new i(25,e),this.fruit=new h(e),this.setInput(n)}return Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),n.prototype.start=function(){var e=this;setInterval((function(){e._status===t.playing&&(e.snake.move(),e.checkCollisions()),e.render.render(e)}),this.speed)},n.prototype.setInput=function(n){var i=this;n&&n.event.addEventListener("input",(function(n){i.snake.movement=s.includes(n.detail)?n.detail:i.snake.movement,i._status===t.menu&&n.detail===e.Enter?(i.snake.reset(25),i.fruit.spawn(),i._status=t.playing):i._status!==t.menu&&n.detail===e.Escape&&(i._status=i._status===t.paused?t.playing:t.paused)}))},n.prototype.reset=function(){this.best=this.snake.points>this.best?this.snake.points:this.best,this._status=t.menu},n.prototype.checkCollisions=function(){this.snake.isDead()?this.reset():this.snake.head.in(this.fruit.position)&&this.snake.eat(this.fruit)},n}();new o({speed:50,width:64,height:36},new(function(){function e(t){document.getElementById("game").innerHTML='    <div class="holder">\n    <span class="text-left">Points: <span id="points"></span></span>\n    <span class="title">Snake</span>\n    <span class="text-right">Best: <span id="best"></span></span>\n    <canvas id="canvas" width="960px" height="540px"></canvas>\n    <span id="paused" class="hidden">GAME PAUSED<br>press ESC key to continue</span>\n    <span id="menu" class="hidden">Press ENTER to start a new game</span>\n  </div>\n',this.pointDOM=document.getElementById("points"),this.bestDOM=document.getElementById("best"),this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.chunk=this.canvas.width/t}return e.prototype.render=function(e){document.getElementById("paused").className=e._status===t.paused?"paused":"hidden",document.getElementById("menu").className=e._status===t.menu?"paused":"hidden",e.best>=0&&(document.getElementById("menu").innerHTML="Points: "+e.snake.points+" (Best: "+e.best+")<br>Press ENTER to start a new game"),this.pointDOM.innerText=(e.snake.points||"0").toString(),this.bestDOM.innerText=(e.best<0?"0":e.best).toString(),this.renderBack(),e._status===t.playing&&(this.renderFruit(e.fruit),this.renderSnake(e.snake))},e.prototype.renderBack=function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.beginPath(),this.ctx.fillStyle="rgb(0,155,0)",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},e.prototype.renderFruit=function(t){this.ctx.fillStyle="rgb(155,0,0)",this.ctx.strokeStyle="rgb(100,0,0)",this.ctx.arc(t.position.x*this.chunk+this.chunk/2,t.position.y*this.chunk+this.chunk/2,this.chunk/3,0,2*Math.PI,!1),this.ctx.fill()},e.prototype.renderSnake=function(t){var e=this;t.body.forEach((function(t){e.ctx.fillStyle="rgb(255,255,0)",e.ctx.fillRect(t.x*e.chunk,t.y*e.chunk,e.chunk,e.chunk),e.ctx.stroke()}))},e}())(64),new function(t){var e=this;this.event=t||new EventTarget;var s=new Map;s.set("ArrowUp","up"),s.set("ArrowDown","down"),s.set("ArrowLeft","left"),s.set("ArrowRight","right"),s.set("Enter","ok"),s.set("Escape","ko"),window.addEventListener("keydown",(function(t){s.has(t.key)&&e.event.dispatchEvent(new CustomEvent("input",{detail:s.get(t.key)}))}))}).start()})();