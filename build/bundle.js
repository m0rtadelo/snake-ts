(()=>{"use strict";var t;!function(t){t[t.menu=0]="menu",t[t.playing=1]="playing",t[t.paused=2]="paused"}(t||(t={}));var e,n=["up","down","left","right"],i=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.in=function(t){return t.x===this.x&&t.y===this.y},t}();!function(t){t.Right="right",t.Left="left",t.Up="up",t.Down="down",t.Enter="ok",t.Escape="ko"}(e||(e={}));var s=function(){function t(t){this.points=0,this.size=0,this.reset(t)}return Object.defineProperty(t.prototype,"head",{get:function(){return this.body[this.body.length-1]},enumerable:!1,configurable:!0}),t.prototype.reset=function(t){this.position=new i(32,18),this.movement=e.Right,this.body=new Array,this.size=t,this.points=0},t.prototype.move=function(){var t=function(t,e){return e+t};this.position.x=t(this.movement===e.Right?1:this.movement===e.Left?-1:0,this.position.x),this.position.y=t(this.movement===e.Down?1:this.movement===e.Up?-1:0,this.position.y),this.body.push(new i(this.position.x,this.position.y)),this.body.length>this.size&&(this.body=this.body.splice(1))},t.prototype.isDead=function(){for(var t=0;t<this.body.length-1;t++)if(this.head.in(this.body[t])||this.head.x<0||this.head.x>=64||this.head.y<0||this.head.y>=36)return!0;return!1},t.prototype.eat=function(t){t.spawn(this.body),this.points++,this.size=this.size+this.points},t}(),o=function(){function t(){this.position=new i(0,0),this.spawn()}return t.prototype.spawn=function(t){var e=this;do{this.position.x=Math.floor(64*Math.random()),this.position.y=Math.floor(36*Math.random())}while(t&&t.some((function(t){return t.in(e.position)})))},t}(),h=function(){function i(e,n,i){this._status=t.menu,this.best=-1,this.speed=e,this.render=n,this.snake=new s(25),this.fruit=new o,this.setInput(i)}return Object.defineProperty(i.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),i.prototype.start=function(){var e=this;setInterval((function(){e._status===t.playing&&(e.snake.move(),e.checkCollisions()),e.render.render(e)}),this.speed)},i.prototype.setInput=function(i){var s=this;i&&i.event.addEventListener("input",(function(i){s.snake.movement=n.includes(i.detail)?i.detail:s.snake.movement,s._status===t.menu&&i.detail===e.Enter?(s.snake.reset(25),s.fruit.spawn(),s._status=t.playing):s._status!==t.menu&&i.detail===e.Escape&&(s._status=s._status===t.paused?t.playing:t.paused)}))},i.prototype.reset=function(){this.best=this.snake.points>this.best?this.snake.points:this.best,this._status=t.menu},i.prototype.checkCollisions=function(){this.snake.isDead()?this.reset():this.snake.head.in(this.fruit.position)&&this.snake.eat(this.fruit)},i}();new h(50,new(function(){function e(){this.pointDOM=document.getElementById("points"),this.bestDOM=document.getElementById("best"),this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.chunk=this.canvas.width/64}return e.prototype.render=function(e){document.getElementById("paused").className=e._status===t.paused?"paused":"hidden",document.getElementById("menu").className=e._status===t.menu?"paused":"hidden",e.best>=0&&(document.getElementById("menu").innerHTML="Points: "+e.snake.points+" (Best: "+e.best+")<br>Press ENTER to start a new game"),this.pointDOM.innerText=(e.snake.points||"0").toString(),this.bestDOM.innerText=(e.best<0?"0":e.best).toString(),this.renderBack(),e._status===t.playing&&(this.renderFruit(e.fruit),this.renderSnake(e.snake))},e.prototype.renderBack=function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.beginPath(),this.ctx.fillStyle="rgb(0,155,0)",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},e.prototype.renderFruit=function(t){this.ctx.fillStyle="rgb(155,0,0)",this.ctx.strokeStyle="rgb(100,0,0)",this.ctx.arc(t.position.x*this.chunk+this.chunk/2,t.position.y*this.chunk+this.chunk/2,this.chunk/3,0,2*Math.PI,!1),this.ctx.fill()},e.prototype.renderSnake=function(t){var e=this;t.body.forEach((function(t){e.ctx.fillStyle="rgb(255,255,0)",e.ctx.fillRect(t.x*e.chunk,t.y*e.chunk,e.chunk,e.chunk),e.ctx.stroke()}))},e}()),new function(t){var e=this;this.event=t||new EventTarget;var n=new Map;n.set("ArrowUp","up"),n.set("ArrowDown","down"),n.set("ArrowLeft","left"),n.set("ArrowRight","right"),n.set("Enter","ok"),n.set("Escape","ko"),window.addEventListener("keydown",(function(t){n.has(t.key)&&e.event.dispatchEvent(new CustomEvent("input",{detail:n.get(t.key)}))}))}).start()})();